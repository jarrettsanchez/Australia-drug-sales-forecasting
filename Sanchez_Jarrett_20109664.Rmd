---
title: "Sanchez Jarrett 20109664"
author: "Jarrett Sanchez"
date: "2023-10-08"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
library(fpp3)
```

## Question 1 - ETS (20 marks)

**0) Scale the data (e.g., divide by 100). From now on, you'll work with the scaled series (0 marks).**

```{r}
# read csv file
aus_steroids <- read.csv("H03_drug_Sales_Australia.csv")

# scale data, convert to time series
steroids <- aus_steroids |>
  mutate(Month = yearmonth(Period), Sales = Sales/100) |>
  select(-Time, -Period) |>
  as_tsibble(index = Month)

steroids
```

**a) Plot the series and discuss the main features, including stationarity (2 marks).**
```{r}
steroids |>
  autoplot(Sales)
```

The series looks non-stationary. There is a clear upwards trend and a strong seasonal pattern. Variability in the data is non-constant, where the variance appears proportional to the level of series over time.

```{r}
steroids |>
  gg_season(Sales)
```

The plot above confirms seasonality. There appears to be a drop in H03 sales around February of each year. This is likely due to Australia's Pharmaceutical Benefits Scheme which subsidises medicine, making it easier for patients to stockpile them at the end of the year. The Scheme's co-payment amount changes on 1 January each year, which explains the increase in sales towards December as patients would like to stockpile medicine before any potential price increase occurs.

```{r}
steroids |>
  gg_subseries(Sales)
```

Strong trend in all months, largest trend in January, larger increase in second half of the year (July to December) compared to first half (excluding January).



**b) Forecast next two years using SES, Holt's linear and Holt's damped trend. Plot the series and the forecasts. Merely based on this plot, discuss the adequacy of these methodologies to forecast from this series. Explain your answer (5 marks total).**
```{r}
# stabilise variance
steroids |>
  autoplot(log(Sales))
```

```{r}
# fit models
fit_ses_holt <- steroids |>
  model(
    'SES' = ETS(log(Sales) ~ error("A") + trend("N") + season("N")),
    'HL' = ETS(log(Sales) ~ error("A") + trend("A") + season("N")),
    'Damped' = ETS(log(Sales) ~ error("A") + trend("Ad") + season("N"))
  )

fc_steroids <- fit_ses_holt |>
  forecast(h=24)

fc_steroids |>
  autoplot(steroids, level=NULL) +
  guides(colour=guide_legend(title="Forecast"))
```

As evident from the plot shown above, the SES, Holt's Linear and Damped methods captured the upwards trend, but did not seem to capture the seasonal aspect of the series. This occurs since the parameter for seasonality in every model is passed the value "N". More specifically, these methodologies are not adequate at forecasting data with seasonality as: SES is suitable for forecasting data with no clear trend or seasonal pattern, while the Holt's Linear + Damped trend methods are suitable for forecasting data with only trend patterns.



**c) Repeat b) with Holt-Winters' seasonal methods. Discuss whether additive or multiplicative seasonality is necessary. Explain your answer (5 marks total).**
```{r}

```



**d) Compare MSE and MAE of one-step-ahead, four-step-ahead, and six-step-ahead forecasts from methods discussed in b and c above. Report your results neatly and clearly. You can use a Table. Which method has the highest accuracy? Does this selection depend on the number of pre-specified (steps-ahead) forecasts? Explain your answer (5 marks total).**


**e) Briefly discuss the potential mistake/error we may unintentionally introduce in the discussion when comparing models b and c using the MSE and MAE. (3 marks)**




